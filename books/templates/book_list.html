{% extends "base.html" %}
{% block content %}

<h1>Seznam knih</h1>

<form method="get" class="filter-form">

    <input type="text" name="title" placeholder="Hledat podle názvu"
           value="{{ request.GET.title }}" />

    <select name="genre">
        <option value="">-- žánr --</option>
        {% for g in genres %}
            <option value="{{ g.id }}"
                {% if request.GET.genre == g.id|stringformat:"s" %} selected {% endif %}>
                {{ g.name }}
            </option>
        {% endfor %}
    </select>

<select name="author">
    <option value="">-- autor --</option>
    {% for a in authors %}
        <option value="{{ a.id }}"
            {% if request.GET.author == a.id|stringformat:"s" %} selected {% endif %}>
            {{ a.first_name }} {{ a.last_name }}
        </option>
    {% endfor %}
</select>

    <input type="number" name="year" placeholder="Rok"
           value="{{ request.GET.year }}" />

    <button type="submit">Filtrovat</button>
    <a href="{% url 'book_list' %}">Reset</a>
</form>

<hr>

<div class="books">
    {% for book in books %}
        <div class="book-item">
            <h3><a href="{{ book.get_detail_url }}">{{ book.title }}</a></h3>

            {% if book.image %}
                <img src="{{ book.image.url }}" width="120">
            {% endif %}

<p><strong>Autor:</strong>
    {% for a in book.authors.all %}
        {{ a.first_name }} {{ a.last_name }}
        {% if not forloop.last %}, {% endif %}
    {% endfor %}
</p>
            <p><strong>Žánr:</strong> 
                {% for g in book.genre.all %} {{ g.name }} {% if not forloop.last %}, {% endif %} {% endfor %}
            </p>

            <p><strong>Rok:</strong> {{ book.year }}</p>
        </div>
        <hr>
    {% empty %}
        <p>Žádné knihy nenalezeny.</p>
    {% endfor %}
</div>

{% endblock %}
